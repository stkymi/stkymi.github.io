---
layout: post
title:  "域控 | 组策略"
date:   2018-03-16 10:35:06
categories:
---
### 活动目录域服务（Active Directory Domain Service）

标识名称（distinguished Name，DN）：它是对象在 Active Directory 内的完整路径，DN 有三个属性，分别是 DC，OU，CN

```
DC (Domain Component)：域名组件；
OU (Organizational Unit)：组织单位
CN (Common Name)：通用名称，一般为用户名或计算机名；
```
域服务的命名与解析必须依赖DNS服务器，在古老的版本中，必须先安装DNS服务，再安装域服务。才可以自动创建相关的DNS记录

创建域用户账户之后，可以直接到域内任意一台非域控制器的计算机上登录域；注意这里并没有在计算机的本地组内添加域用户，若是没有连接到域服务器，登录时会提示`目前没有可用的登录服务器处理登录请求。`

默认情况下，域用户可以登录域内任意一台非域控服务器的计算机，因为域管理员在新增用户时 该域用户默认就会存在域用户组中（`domain users`），而默认加入域的域成员机器其本地的`users`组中包含了全局的`domain users`组成员，而域成员机器本地组策略中`允许在本地登陆`属性中包含了本地`users`组。

限制域用户只能登陆指定计算机有两种方法：1、设置某个域用户只能登陆到指定计算机 2、修改组策略：计算机配置--windows设置--安全设置--本地策略--用户权限分配，修改 "允许本地登陆" 中包含的组；可以在该属性中只允许本地管理员组用户登陆，然后把指定域用户加入到指定域成员机器本地管理员组。或者直接在该"允许本地登陆"中添加想要登陆的组或域成员

### 管理域计算机

**委派管理：** Active Directory用户和计算机管理单元可以使用两种方式更新ACL来委派管理：

*使用控制委派向导：它允许在域/组织单位级别委派新权限*

*使用“安全”选项卡：它允许委派或删除权限*

打开“ADSI编辑器”，域属性列表中`ms-DS-NachineAccountQuota`的值为普通域用户允许添加的计算机帐户数量；如果在加域前创建计算机帐户并授权给特定域用户，则不受此限制。委派特定用户`Client`“将计算机加入域”权限，实质为`Computers`的安全选项卡权限“创建 计算机 对象”

普通用户将计算机加域，则此计算机帐户的"所有者"值为`Domain Admins`。如果是使用管理员赋予的权限加入域的，则此计算机帐户的"所有者"值就是加入域所使用的域用户帐户。假设委派了两位域用户UserA和UserB"将计算机加入域"即赋予了在`Computers`容器"创建 计算机 对象"的权限。然后，UserA成功加入了一台计算机PCA后离开，由于重装系统等原因UserB将同一计算机名加域，则会提示“拒绝访问”。因为UserA是PCA计算机帐户的"所有者"并拥有一系列在此计算机帐户上的权限（包括读取、更改密码），UserB由于不是域管理员，不能覆盖重写这个计算机帐户。

**解决思路：**

方法一、在`Computers`容器的安全选项卡权限中添加`Client`对“计算机对象”的一系列权限

方法二、将计算机帐户删除，再让`Client`去加域(如果没有委派`Client`加域权限，还需要重建此计算机帐户并授权)

方法三、将`Client`帐户添加到系统内置组`Account Operators`(附：这个组拥有用户、组、计算机对象的完全控制权限)



### 组策略（Group Policy）

组策略分为本地组策略和域组策略

`Windows + R`运行 `gpedit.msc`启动本地组策略

`Windows + R`运行 `gpmc.msc`启动域组策略；或者开始->管理工具->组策略管理

域组策略分为3类，按照执行顺序分别是站点、域名、OU；相应的名字右键、属性有组策略选项卡。若是这3类组策略有冲突，后执行的为结果

*Update Service*

计算机配置->管理模板->Windows组件->Windows Update->指定Intranet Microsoft更新服务位置

*密码策略*

计算机配置->Windows设置->安全设置->帐户策略->密码策略

*计算机管理*

用户配置->管理模板->Windows组件->Microsoft Management Console->受限的/许可的管理单元

*阻止访问命令提示符* *阻止访问注册表编辑工具*

用户配置->管理模板->系统


